#define CAYENNE_DEBUG
#define CAYENNE_PRINT Serial
#include <CayenneMQTTESP8266.h>

//IRSEND
#include <IRremoteESP8266.h>
#include <IRsend.h>

const uint16_t kIrLed = 3;  // ESP8266 GPIO pin to use. Recommended: 4 (D2).
IRsend irsend(kIrLed);  // Set the GPIO to be used to sending the message.

int ESTADO = 0;
int COMANDO = 0;
int ULTIMO_COMANDO = 0;

uint16_t DESLIGA[227] = {3134, 1556,  528, 1056,  524, 1058,  524, 296,  522, 292,  524, 294,  522, 1060,  522, 294,  522, 294,  526, 1058,  524, 1058,  524, 292,  526, 1056,  524, 292,  524, 292,  524, 1060,  522, 1058,  524, 292,  524, 1058,  524, 1058,  526, 292,  524, 294,  524, 1056,  526, 292,  524, 294,  524, 1058,  524, 294,  524, 292,  526, 292,  524, 292,  524, 292,  524, 294,  524, 292,  524, 292,  524, 292,  526, 292,  548, 268,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  548, 268,  524, 292,  524, 1058,  524, 294,  524, 292,  524, 1058,  524, 1058,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  548, 1034,  524, 292,  524, 292,  524, 1056,  524, 292,  524, 292,  524, 292,  524, 292,  526, 1056,  524, 292,  524, 1058,  524, 292,  524, 292,  526, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  524, 292,  526, 292,  526, 290,  526, 290,  526, 290,  526, 292,  550, 266,  526, 292,  524, 292,  524, 292,  526, 292,  524, 292,  526, 290,  526, 292,  524, 292,  524, 292,  524, 290,  526, 292,  526, 292,  546, 268,  526, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  524, 1058,  524, 292,  524, 1058,  524, 1058,  524, 292,  524, 292,  524, 292,  526, 1056,  524, 1058,  526};
uint16_t T22[227] = {3136, 1558,  526, 1058,  524, 1060,  520, 296,  522, 292,  526, 292,  522, 1058,  526, 292,  526, 290,  526, 1058,  524, 1058,  528, 292,  522, 1058,  524, 292,  524, 296,  520, 1060,  522, 1058,  524, 292,  524, 1056,  526, 1058,  524, 292,  524, 292,  524, 1058,  524, 292,  524, 292,  526, 1056,  524, 292,  522, 294,  524, 292,  526, 292,  524, 292,  522, 294,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 296,  520, 292,  524, 292,  524, 1058,  524, 292,  524, 292,  524, 1058,  524, 292,  524, 292,  524, 1056,  524, 1058,  524, 294,  524, 292,  526, 292,  524, 292,  524, 292,  524, 292,  524, 1058,  524, 292,  524, 292,  524, 1058,  524, 292,  526, 292,  524, 292,  524, 292,  548, 1032,  524, 292,  524, 1058,  524, 292,  524, 292,  524, 294,  522, 292,  524, 294,  524, 292,  526, 290,  524, 292,  550, 266,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 290,  524, 292,  524, 292,  524, 292,  526, 292,  524, 292,  524, 292,  526, 292,  524, 292,  524, 292,  526, 290,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 1058,  548, 268,  548, 1034,  526, 292,  550, 1032,  524, 292,  524, 292,  524, 1058,  524, 1058,  524};
uint16_t T23[227] = {3134, 1560,  522, 1058,  524, 1056,  524, 294,  522, 294,  524, 294,  524, 1056,  524, 294,  522, 294,  524, 1056,  526, 1058,  524, 292,  522, 1058,  524, 292,  522, 294,  524, 1058,  522, 1060,  524, 294,  524, 1058,  524, 1060,  524, 294,  524, 292,  524, 1056,  524, 294,  522, 294,  522, 1058,  524, 294,  522, 294,  524, 294,  522, 294,  522, 294,  524, 292,  524, 292,  522, 294,  522, 294,  524, 294,  522, 294,  522, 292,  524, 294,  522, 292,  524, 292,  524, 294,  522, 294,  522, 1056,  524, 294,  524, 292,  522, 1058,  524, 294,  522, 292,  524, 1056,  524, 1058,  526, 292,  522, 294,  524, 292,  524, 292,  524, 292,  524, 294,  522, 292,  524, 292,  522, 292,  524, 1058,  526, 292,  522, 294,  522, 292,  524, 292,  522, 1058,  526, 292,  522, 1058,  526, 292,  524, 294,  522, 292,  524, 292,  524, 292,  522, 294,  522, 292,  524, 294,  522, 294,  522, 294,  524, 292,  524, 292,  524, 292,  522, 294,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 294,  522, 292,  524, 294,  522, 292,  524, 292,  524, 292,  522, 294,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  522, 294,  524, 292,  524, 1056,  524, 1056,  526, 292,  524, 292,  524, 1056,  526, 292,  524, 292,  524, 1056,  526, 1056,  526};
uint16_t T24[227] = {3132, 1560,  524, 1058,  524, 1058,  522, 298,  520, 294,  524, 292,  524, 1058,  524, 294,  524, 294,  522, 1058,  524, 1058,  526, 292,  524, 1056,  526, 292,  524, 292,  524, 1058,  524, 1058,  524, 292,  524, 1058,  524, 1058,  524, 292,  524, 294,  524, 1058,  524, 292,  524, 292,  524, 1058,  524, 292,  524, 294,  524, 292,  524, 294,  524, 292,  524, 292,  524, 292,  522, 294,  524, 292,  524, 294,  522, 294,  524, 292,  524, 292,  524, 294,  524, 292,  524, 292,  524, 292,  524, 1058,  524, 294,  522, 294,  522, 1058,  524, 292,  524, 294,  524, 1058,  524, 1058,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  522, 1058,  524, 1058,  524, 1058,  526, 292,  524, 292,  524, 292,  526, 290,  526, 292,  524, 1058,  524, 294,  524, 1056,  524, 292,  524, 292,  526, 292,  522, 292,  524, 292,  524, 292,  522, 292,  524, 294,  524, 292,  524, 290,  526, 292,  524, 292,  524, 294,  524, 292,  524, 292,  522, 294,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 290,  524, 292,  524, 292,  524, 292,  526, 290,  526, 292,  524, 1056,  526, 292,  524, 292,  524, 292,  526, 1056,  526, 292,  526, 292,  524, 1056,  524, 1056,  526};
//uint16_t T25[227] = {3134, 1556,  528, 1056,  524, 1058,  524, 296,  522, 292,  524, 294,  522, 1060,  522, 294,  522, 294,  526, 1058,  524, 1058,  524, 292,  526, 1056,  524, 292,  524, 292,  524, 1060,  522, 1058,  524, 292,  524, 1058,  524, 1058,  526, 292,  524, 294,  524, 1056,  526, 292,  524, 294,  524, 1058,  524, 294,  524, 292,  526, 292,  524, 292,  524, 292,  524, 294,  524, 292,  524, 292,  524, 292,  526, 292,  548, 268,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  548, 268,  524, 292,  524, 1058,  524, 294,  524, 292,  524, 1058,  524, 1058,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  548, 1034,  524, 292,  524, 292,  524, 1056,  524, 292,  524, 292,  524, 292,  524, 292,  526, 1056,  524, 292,  524, 1058,  524, 292,  524, 292,  526, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  524, 292,  526, 292,  526, 290,  526, 290,  526, 290,  526, 292,  550, 266,  526, 292,  524, 292,  524, 292,  526, 292,  524, 292,  526, 290,  526, 292,  524, 292,  524, 292,  524, 290,  526, 292,  526, 292,  546, 268,  526, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  524, 292,  526, 292,  524, 1058,  524, 292,  524, 1058,  524, 1058,  524, 292,  524, 292,  524, 292,  526, 1056,  524, 1058,  526};


// WiFi network info.
char ssid[] = "RMWAPAC";
char wifiPassword[] = "";

// Cayenne authentication info. This should be obtained from the Cayenne Dashboard.
char username[] = "e324a620-d208-11e6-97cc-8758d0339dd8";
char password[] = "bc71f20f8d6dd82acca0273c82c4fd7b1acc571a";
char clientID[] = "c97fddc0-5483-11e9-86b5-4fe3d2557533";


void setup() {
  Serial.begin(9600);
  Cayenne.begin(username, password, clientID, ssid, wifiPassword);
  pinMode(3, OUTPUT);

}

void loop() {
  Cayenne.loop();
  if (ESTADO == 0 && ULTIMO_COMANDO != 0){
    //DESLIGA
    irsend.sendRaw(DESLIGA, 227, 38);
    ULTIMO_COMANDO = 0;
  }
  else{
    if (COMANDO == 22 && ULTIMO_COMANDO != 22){
      irsend.sendRaw(T22, 227, 38);
      ULTIMO_COMANDO = 22;
    }
    if (COMANDO == 23 && ULTIMO_COMANDO != 23){
      irsend.sendRaw(T23, 227, 38);
      ULTIMO_COMANDO = 23;
    }
    if (COMANDO == 24 && ULTIMO_COMANDO != 24){
      irsend.sendRaw(T24, 227, 38);
      ULTIMO_COMANDO = 24;
    }
  }
}

CAYENNE_IN(0)
{
  ESTADO = getValue.asInt();
}

CAYENNE_IN(1)
{
  COMANDO = getValue.asInt();
}
